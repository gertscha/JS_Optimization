<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>JS Lib Doc</title>
<link rel="stylesheet" href="resources/styleguide.css">
<link rel="shortcut icon" href="resources/favicon.ico">
<script src="resources/styleguide.js"></script>
</head>
<body onload="initStyleGuide();">

<div class="flex-container">
<div class="left-border"></div>
<div id="content">
<h1>JS Lib Documentation</h1>

<h2 id="Background" class="ignoreLink">Background</h2>

<p>Orginally this repository was part of a course project for the course "Optimization
  Methods for Engineers" (227-0707-00L) at ETH Zurich.<br> The goal of the project was to
  implement an optimizer for a chosen problem (and write a report).</p>
<p>The problem is Job Shop scheduling, where a set of N tasks need to be scheduled on M
  machines. Each tasks consist of subtasks that have a processing order, varying processing
  times and need to be processed on a specific machine.<br>
  A machine can only process a single subtask at a time and subtasks are non-preemptable.</p>
<p>A mathematical description of the problem is contained in the report.</p>
<p>The goal is to compare the results of different Simulated Annealing implementations.
  In particular, I will examine how different (random) step procedures and search space
  representations affect the quality of the results.</p>

<h5 id="credit" class="ignoreLink">Documentation Credit</h5>

<p>This documentation uses styles and javascript taken from the
  <a href="https://github.com/google/styleguide"> Google Style Guides</a> for C++.</p>


<!--Create the Table of Contents -->
<div class="horizontal_toc" id="tocDiv"></div>


<h2 id="components">Components Overview</h2>

<p>The JS_Optimizer Visual Studio Solution contains three projects. They are two libraries
  (JS_Lib and loguru) and the entry point JS_Optimizer.</p>
<p>The following subsections briefly describe each project.</p>

<h3 id="js_optimizer">JS Optimizer</h3>

<p>This project is designated as the executable for the CMake build and it contains the
  main.cpp file.</p>
<p>The JS_Optimizer project servers as a minimalist wrapper for the JS_Lib functionality
  and enables the creation of actual executables that perform optimization.<br>
  There is no proper user interface, the configuration of the optimizations is done by
  changing the code in the main.cpp file.</p>
<p>Besides the main function it contains three additional functions:</p>
<ul>
  <li>a small sanity test function to verify that the project is setup correctly </li>
  <li>the 'runOptimizer' template function that shows how to create a Problem and Optimizer
    and then run the Optimizer. It also shows how to validate and store the Solution. The
    configuration needs to be done manually.</li>
  <li>the 'evaluateOptimizers' function that uses the StatsCollector utility class to run
    and log an optimizer on many problems in bulk.</li>
</ul>
<p>These three functions and the commented lines in the main function provide some usage
  examples.</p>

<h3 id="optimizer">JS Lib</h3>

<p>This project is the core functionality. All the optimization code is completely
  contained inside the JS_Lib project.<br> There are four kinds of objects in JS_Lib:
  problem_base, optimizer_base, optimizers and utility.</p>

<figure style ="width:500px">
  <img src="resources/assets/JS_Lib_UML.svg" alt="UML Diagram of JS_Lib" width="500">
  <figcaption>For clarity reasons not all associations are depicted, the most obvious
    omissions are the links from problem_base to the optimizers</figcaption>
</figure>

<p>The 'problem_base' enables the creation, saving and loading of problem and solution
  definitions.</p>
<p>The 'optimizer_base' which defines a base class for all optimizers in 'Optimizer.h'.
  It also defines three possible representations on which an optimizer can operate.<br>
  The representations provide initialisation and basic manipulation of the representation
  as well as the creation of Solutions.</p>
<p>Optimizers choose a representation and then define the initialisation, iteration and
  termination functions that are used to run an optimizer. Currently there are four
  different optimizers implemented</p>
<p>Both new representations and optimizers can be added (do not forget to add new
  optimizers to the JS_Lib.h in the include folder). <br>
  All optimizers should subclass/extend the Optimizer class defined in Optimizer.h. However
  using a representation is not required.</p>
<p>For more details see the <a href="#structure">JS Lib</a> section below.</p>

<h3 id="loguru">Loguru</h3>

<p>For the logging needs of the project the logging library "loguru" by emilk is used.
  See his <a href="https://github.com/emilk/loguru"> github repository</a>.</p>
<p>Version 2.1.0 cloned in April 2023 is included/setup in this repository. Refer to it's 
  <a href="loguru_docs/index.html">documentation</a> and the README in the loguru folder
  for usage details.</p>

<h3 id="dependencies">Dependencies</h3>

<p>The project uses CMake to setup the Visual Studio solution, hence it requries both
  CMake and Visual Studio.</p>
<p>There are a couple optional helper scripts that require a Python installation
  (see <a href="#PythonScripts">Python Helper Scripts</a>).</p>

<h2 id="js_lib">JS Lib</h2>

<h3 id="js_problem">Problems</h3>

<p>See <a href="#problem_format">Problem Description</a> </p>

<h3 id="js_solution">Solutions</h3>

<p>See <a href="#solution_format">Solution Description</a> </p>

<h3 id="js_optimizer_base">Optimizer Base</h3>
<p> These classes are meant to be subclassed. </p>

  
<h4 id="js_optimizer_machine_order_rep">Machine Order representation</h4>

<figure>
  <img src="resources/assets/machine_seq.svg" width="500"
    alt="Visualization of Machine Order Rep" >
</figure>

<h4 id="js_optimizer_global_order_rep">Global Order representation</h4>

<figure>
  <img src="resources/assets/total_order.svg" width="600" 
    alt="Visualization of Total Order Rep">
</figure>

<h4 id="js_optimizer_graph_rep">Graph representation</h4>

<figure>
  <img src="resources/assets/Graph_Rep.svg" width="400"
    alt="Visualization of Graph Rep components">
</figure>

<h3 id="js_optimizers">Optimizers</h3>

<p>All Optimizer's subclass one of the optimizer_base classes. The different Representation
  classes implement some common funcionality that a given search space representation
  may need.</p>
<p>Thsese classes are not meant to be subclassed.</p>
<p>Usually the main functionality that they provide is the implementation of a constructor
  for the Solution class.</p>

<h3 id="js_utility">Utility</h3>


<h2 id="file_formats">File Formats</h2>

<p>Problems and Solutions are stored and read from text files.
  There are three file formats, two for Poblems and one for Solutions.
  The required formats are detailed in the next sections</p>

<h3 id="problem_format">Problem Description</h3>

<p>A Job Shop problem consists of Tasks, a Task consists of Steps, a single Step runs on a
  specific machine and takes a set amount of time.</p>
<p>This project supports two formats, called <b>Standard</b> and <b>Detailed</b>. For
  custom problems the Detailed format is recommended because it allows for more consistency
  checks during parsing.</p>
<p> The Standard format was introduced to be compatible with the format used for the public 
  <a href="http://jobshop.jjvh.nl/index.php"> JobShop Instances</a> that were/are
  researched and have known optima.</p>

<h4 id="problem_format_detailed">Detailed Format</h4>

<p>The format to define a problem in the <b>Detailed</b> format is as follows:</p>
<ul>
    <li>The first line contains two numbers: 'task count' and 'machine count', they specify
      how many tasks and how many machines the problem contains</li>
    <li>Every line afterwards defines exactly one <b>task</b>. This is done by first
      specifying the number of Steps the Task has. Then each Step is specified by a pair
      that defines the 'machine' and 'duration' of the Step. The sequence of the steps on
      a line defines the order in which the Steps need to be prcessed.</li>
</ul>
<p>For the Step defintions to be legal 'machine' has to be in the range [0,machine_count]
  and 'duration' must be >= 0. All values must be integers. The number of tasks must also
  match the number of tasks that was specified.<br> The comma can be replaced by any
  character or removed altogether.</p>
<p>During parsing the first continous block of lines starting with '#' will be ignored as
  comments.</p>
  <figure style ="width:600px">
<p class="example"></p>
<pre># comment lines are possible, no identation allowed before '#'
3 5
6, 0 8, 3 6, 4 10, 0 3, 1 9, 2 5
4, 3 4, 0 12, 4 16, 3 8
7, 4 19, 2 8, 0 6, 1 10, 3 7, 1 5, 2 9
</pre>
</figure>

<h4 id="problem_format_standard">Standard Format</h4>

<p>The format to define a problem in the <b>Standard</b> format is as follows:</p>
<ul>
    <li>The first line contains three numbers: 'task count' and 'machine count' and 'lower
      bound', they specify how many tasks and how many machines the problem contains as
      well as the known optimal lower bound</li>
    <li>Every line afterwards defines exactly one <b>task</b>. This is done by giving a
      pair for each Step is specified by a pair that defines the 'machine' and 'duration'
      of the Step. The sequence of the steps on a line defines the order in which the
      Steps need to be prcessed.</li>
</ul>
<p>For the Step defintions to be legal 'machine' has to be in the range [0,machine_count]
  and 'duration' must be >= 0. All values must be integers.</p>
<p>Any white-space separator works, including multiple ones. The Problems in the Instances
  folder use tabs.</p>
<figure style ="width:600px">
<p class="example"></p>
<p>the abz5 problem</p>
<pre>
10  10  1234
4	88	8	68	6	94	5	99	1	67	2	89	9	77	7	99	0	86	3	92
5	72	3	50	6	69	4	75	2	94	8	66	0	92	1	82	7	94	9	63
9	83	8	61	0	83	1	65	6	64	5	85	7	78	4	85	2	55	3	77
7	94	2	68	1	61	4	99	3	54	6	75	5	66	0	76	9	63	8	67
3	69	4	88	9	82	8	95	0	99	2	67	6	95	5	68	7	67	1	86
1	99	4	81	5	64	6	66	8	80	2	80	7	69	9	62	3	79	0	88
7	50	1	86	4	97	3	96	0	95	8	97	2	66	5	99	6	52	9	71
4	98	6	73	3	82	2	51	1	71	5	94	7	85	0	62	8	95	9	79
0	94	6	71	3	81	7	85	1	66	2	90	4	76	5	58	8	93	9	97
3	50	0	59	1	82	8	67	7	56	9	96	6	58	4	81	5	59	2	96   
</pre>
</figure>

<h3 id="solution_format">Solution Description</h3>

<p> Solutions have one format. The Python visualizations scripts that create Gnatt Charts
  depended on this to parse Solutons, in particular the comma separator is mandatory.</p>
<p>The format to define a problem in the <b>Standard</b> format is as follows:</p>
<ul>
    <li>The first line is the name of the Solution. This is accessible if the Solution is
      loaded in the C++ program and it will be displayed in the Python visualizations.</li>
    <li>The second line contains two numbers: 'task count' and 'machine count', they
      specify how many tasks and how many machines the Solution contains</li>
    <li>Every line afterwards corresponds to a <b>machine</b>. The first number is the
      number of Steps the Machine processes. After that there is a six-tuple for each Step.
      The tuples are separated by commas and have the format: 'task id' 'step index'
      'machine' 'duration' 'start time' 'end time' </li>
</ul>
<p>The Steps and Tasks that can be reconstructed from the Solution must match the Problem
  it should solve. This can be checked with the Solution::validateSolution() function for
  arbitrary pairs of Solutions and Problems.</p>
<p>During parsing the first continous block of lines starting with '#' will be ignored
  as comments.</p>
<figure style ="width:600px">
<p class="example"></p>
<pre>
SmallTestingProblemSolution
3 5
4, 0 0 0 8 0 8, 1 1 0 12 8 20, 2 2 0 6 27 33, 0 3 0 3 33 36
3, 2 3 1 10 33 43, 0 4 1 9 43 52, 2 5 1 5 52 57
3, 2 1 2 8 19 27, 0 5 2 5 52 57, 2 6 2 9 57 66
4, 1 0 3 4 0 4, 0 1 3 6 8 14, 2 4 3 7 43 50, 1 3 3 8 50 58
3, 2 0 4 19 0 19, 0 2 4 10 19 29, 1 2 4 16 29 45
</pre>
</figure>
<p>This is a Solution for the example given in the
  <a href="#problem_format_detailed">Detailed Format</a></p>
<p> Using the Python Script to create a Gnatt Chart for this Solution:</p>
<figure>  
  <img src="resources/assets/SmallTestingSolutionVis.png" width="600"
    alt="Visualization of Small Testing Solution" >
</figure>

<h2 id="PythonScripts">Python Helper Scripts</h2>

<p>The helper scripts are located in the 'PythonScripts' Folder at the root of the project.
  The two main scripts are "createGnattFromFile.py" and "Google_OR_Tools.py".</p>

<h3 id="createGnatt">Create Gnatt Visualization</h3>

<p>Creates a visualization of a Solution using Matplotlib. Example usage:</p>
<figure style ="width:500px">
  <pre>$ python createGanttFromFile.py -ri dmu/dmu06.txt </pre>
</figure>
<p>Use the '-h' or '-help' flag to get the complete information about the usage.</p>
<p>For very large Solutions the chart may struggle to display all the labels in a readable manner.</p>

<h3 id="GoogleORTools">Google OR Tools</h3>

<p>This is a simple wrapper for the <a href="https://developers.google.com/optimization?hl=en">
  Google OR-Tools</a> that can solve JobShop problems with a CP-Solver. It requires the installation
  of the ORTools module (see <a href="https://developers.google.com/optimization/install?hl=en">
  OR-Tools Install</a> and follow the python guide).</p>
<p>The wrapper enforces a TIMEOUT constraint. Example usage:</p>
<figure style ="width:500px">
  <pre>$ python Google_OR_Tools.py -ri dmu/dmu06.txt -t 20 </pre>
</figure>
<p>Use the '-h' or '-help' flag to get the complete information about the usage.</p>
<p>Additionally there is also the 'runOR_Tools.py' script. It runs 'Google_OR_Tools.py' on multiple files.</p>
<p>'runOR_Tools.py' does not take any arguments, instead the code should be edited directly.
  Especiall the python version must be set correctly as it currently uses an alias to a custom install location.
</p>

</div>
<div class="right-border"></div>
</div>
</body>
</html>